<!DOCTYPE html>
<html lang="pt-br" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>CRUD de cliente</title>
        <link rel="stylesheet" href="/CSS/styles.css">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
		<link rel="icon" href="/Images/favicon.ico" type="image/x-icon">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
		<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha384-KyZXEAg3QhqLMpG8r+Knujsl5/6f5xX5L0d7/1XshTLF5j8l2/zg7L2Dd6fR5Jp4C" crossorigin="anonymous"></script>
	</head>
    <body>
		<nav class="navbar navbar-custom fixed-top">
			<div class="container-fluid">
				<div class="navbar-header">
					<a id="upper-navbar-text" class="navbar-brand">CRUD DE CLIENTE</a>
				</div>

				<ul class="navbar-nav">
					<li class="nav-item">
						<a class="btn btn-default" id="add-client-button" href="createClient">Adicionar cliente</a>
					</li>
				</ul>

			</div>
		</nav>

		<div class="container mt-5">
			<div style="max-width: 1200px; margin: 0 auto">
				<table class="table table-striped table-hover">
					<thead class="table-dark">
						<tr>
							<th>ID</th>
							<th>Nome completo</th>
							<th>Senha</th>
							<th>Gênero</th>
							<th>Data de nascimento</th>
							<th>CPF</th>
							<th>Email</th>
							<th>Endereços</th>
							<th>Telefone</th>
							<th>Ativo</th>

						</tr>
					</thead>
					<tbody>
						<tr th:each="client : ${clients}">
							<td th:text = "${client.id}"></td>
							<td th:text = "${client.name}"></td>
							<td th:text = "${client.password}"></td>
							<td th:text = "${client.gender.genderType}"></td>
							<td th:text = "${#temporals.format(client.birthday, 'dd-MM-yyyy')}"></td>
							<td th:text = "${client.cpf}"></td>
							<td th:text = "${client.email}"></td>
							<td>
								<button type="button" class="btn btn-secondary" th:data-bs-client-id = "${client.id}" data-bs-toggle="modal" data-bs-target="#seeAddressModal" >Ver endereços</button>
							</td>
							<td th:text = "${client.phone.phoneNumber}"></td>
							<td>
								<input type="checkbox" th:checked="${client.enabled}" disabled>
							</td>


							<!--
								<a class="btn btn-primary" th:href="@{updateClient/{id}(id=${client.id})}">Atualizar</a>

								<form th:action="@{/deleteClient/{id}(id=${client.id})}" method="POST" display="inline">
									<input type="hidden" name="_method" value="DELETE"/>
									<button type="submit" class="btn btn-danger btn-delete" onclick="return confirm('Tem certeza?')">Deletar</button>
								</form>
							</td>
							-->
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<div id="seeAddressModal" class="modal fade">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h3 class="modal-title">Ver endereços</h3>
						<button type="button" class="btn btn-close" data-bs-dismiss="modal"></button>
					</div>

					<div class="modal-body">

						<div>
							<h1 id="clientId"></h1>

							<button type="button" class="btn btn-success"
							data-bs-toggle="offcanvas" data-bs-target="#addressFormCanvas" aria-controls="addressFormCanvas" id="addAddressButton">
								Adicionar endereço
							</button>

							<div class="card mt-3">
								<div class="card-body">
									<h2 class="card-title">Endereços de entrega</h2>
									<div id="deliveryAddressList">

									</div>
								</div>
							</div>

							<div class="card mt-3">
								<div class="card-body">
									<h2 class="card-title">Endereços de cobrança</h2>
									<div id="chargingAddressList">

									</div>
								</div>
							</div>

						</div>

					</div>

					<div class="modal-footer">

						<button type="button" class="btn btn-danger" data-bs-dismiss="modal">Fechar</button>
					</div>

				</div>

			</div>
		</div>

                <div class="offcanvas offcanvas-start" tabindex="-1" id="addressFormCanvas" aria-labelledby="addressFormCanvasLabel">
                    <div class="offcanvas-header">
                        <h5 id="addressFormCanvasLabel">Adicionar Endereço</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                    </div>

                    <div class="offcanvas-body">
						<h1 ></h1>

						<form th:object="${clientAddressDTO}" method="POST" id="addressCreateForm">
							<div>
                                <label><b>Tipo</b></label>
                                <div class="radio-group">
									<label><input type="radio" th:field="*{address.addressType}" th:value="false"> Entrega</label>
									<label><input type="radio" th:field="*{address.addressType}" th:value="true"/> Cobrança</label>
                                </div>
                            </div>

                            <div>
                                <label><b>Apelido</b></label>
                                <input type="text" class="form-control" placeholder="Digite o apelido" th:field="*{address.nickname}" required>
                            </div>

                            <div>
                                <label><b>Tipo de Residência</b></label>
                                <input type="text" class="form-control" placeholder="(Casa, apartamento, etc...)" th:field="*{address.typeOfResidence}" required>
                            </div>

                            <div>
                                <label><b>Tipo de logradouro</b></label>
                                <input type="text" class="form-control" placeholder="(Rua, Avenida, etc...)" th:field="*{address.addressingType}" required>
                            </div>

                            <div>
                                <label><b>Logradouro</b></label>
                                <input type="text" class="form-control" placeholder="Insira o logradouro" th:field="*{address.addressing}" required>
                            </div>

                            <div>
                                <label><b>Nº de residência</b></label>
                                <input type="text" class="form-control" placeholder="Insira o número da residência" th:field="*{address.houseNumber}" maxlength="5" required>
                            </div>

                            <div>
                                <label><b>CEP</b></label>
                                <input type="text" class="form-control" placeholder="00000-000" th:field="*{address.cep}" maxlength="9" required>
                            </div>

                            <div>
                                <label><b>Bairro</b></label>
                                <input type="text" class="form-control" placeholder="Insira o bairro" th:field="*{address.neighbourhood}" required>
                            </div>

                            <div>
                                <label><b>Cidade</b></label>
                                <input type="text" class="form-control" placeholder="Insira a cidade" th:field="*{address.city}" required>
                            </div>

                            <div>
                                <label><b>Estado</b></label>
                                <input type="text" class="form-control" placeholder="Insira o Estado" th:field="*{address.state}" required>
                            </div>

                            <div>
                                <label><b>País</b></label>
                                <input type="text" class="form-control" placeholder="Insira o País" th:field="*{address.country}" required>
                            </div>

                            <div>
                                <label><b>Observação</b></label>
                                <input type="text" class="form-control" placeholder="Insira uma observação (opcional)" th:field="*{address.observation}">
                            </div>

							<div class="mt-2">
								<button type="submit" class="btn btn-primary">Salvar Endereço</button>
							</div>

                        </form>
                    </div>
				</div>




		<script>

			const seeAddressModal = document.getElementById("seeAddressModal");
			const addAddressButton = document.getElementById("addAddressButton");

			seeAddressModal.addEventListener('show.bs.modal', function (event) {
				const button = event.relatedTarget

				const clientId = button.getAttribute('data-bs-client-id');


				const elementWithId = document.getElementById('clientId');
				elementWithId.textContent = 'ID do cliente: '
				elementWithId.textContent = elementWithId.textContent + " " + clientId;

				addAddressButton.setAttribute('data-bs-client-id', clientId);

				fetch(`index/${clientId}/addresses`)
						.then(response => {
							if(!response.ok) {
								throw new Error("Erro ao retornar endereços.");
							}
							return response.json();
						})
						.then(addresses => {
							const deliveryAddressList = document.getElementById('deliveryAddressList');
							const chargingAddressList = document.getElementById('chargingAddressList');
							let deliveryAddresses = '';
							let chargingAddresses = '';
							let addressCollapseCardId = 1;
								addresses.forEach(address => {
									const addressItem = `
														<div class="card mt-3">
															<div class="card-body">
																<h3 class="card-title">ID: ${address.id}</h3>
																<h4>${address.nickname}</h4>
																<button class="btn" data-bs-toggle="collapse" data-bs-target="#addressCollapseCardId_${addressCollapseCardId}">
																	<i class="bi bi-chevron-down"></i>
																</button>
																<div id="addressCollapseCardId_${addressCollapseCardId}" class="collapse">
																	<p>Tipo de residência: ${address.typeOfResidence}</p>
																	<p>Logradouro: ${address.addressing}</p>
																	<p>Número: ${address.houseNumber}</p>
																	<p>Bairro: ${address.neighbourhood}</p>
																	<p>Tipo de logradouro: ${address.addressingType}</p>
																	<p>CEP: ${address.cep}</p>
																	<p>Cidade: ${address.city}</p>
																	<p>Estado: ${address.state}</p>
																	<p>País: ${address.country}</p>
																	<p>Observação: ${address.observation}</p>
																	<button type="button" class="btn btn-danger" >Deletar</button>
																	<button type="button" class="btn btn-primary">Atualizar</button>
																</div>

															</div>
														</div>`;
									addressCollapseCardId += 1;
									if(address.addressType == false) {
										deliveryAddresses += addressItem;
									} else {
										chargingAddresses += addressItem;
									}
								});
								deliveryAddressList.innerHTML = deliveryAddresses;
								chargingAddressList.innerHTML = chargingAddresses;
							})
			});

			const addressOffcanvas = document.getElementById("addressFormCanvas");

			addressOffcanvas.addEventListener('show.bs.offcanvas', function(event) {
				const clientId = addAddressButton.getAttribute('data-bs-client-id');

				const addressForm = document.getElementById("addressCreateForm");
				addressForm.setAttribute('action', `/index/${clientId}/addresses/create`);
			});




		</script>


		<footer id="footer">
			<img src="/Images/figureoutlogo1.svg">
		</footer>



    </body>
</html>